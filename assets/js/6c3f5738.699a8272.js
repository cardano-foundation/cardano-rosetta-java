"use strict";(self.webpackChunkrosetta_docs=self.webpackChunkrosetta_docs||[]).push([[6188],{5537:(e,n,o)=>{o.d(n,{A:()=>k});var r=o(6540),t=o(4164),s=o(5627),a=o(6347),i=o(372),l=o(604),c=o(1861),d=o(8749);function u(e){return r.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,r.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:n,children:o}=e;return(0,r.useMemo)((()=>{const e=n??function(e){return u(e).map((e=>{let{props:{value:n,label:o,attributes:r,default:t}}=e;return{value:n,label:o,attributes:r,default:t}}))}(o);return function(e){const n=(0,c.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,o])}function p(e){let{value:n,tabValues:o}=e;return o.some((e=>e.value===n))}function m(e){let{queryString:n=!1,groupId:o}=e;const t=(0,a.W6)(),s=function(e){let{queryString:n=!1,groupId:o}=e;if("string"==typeof n)return n;if(!1===n)return null;if(!0===n&&!o)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return o??null}({queryString:n,groupId:o});return[(0,l.aZ)(s),(0,r.useCallback)((e=>{if(!s)return;const n=new URLSearchParams(t.location.search);n.set(s,e),t.replace({...t.location,search:n.toString()})}),[s,t])]}function f(e){const{defaultValue:n,queryString:o=!1,groupId:t}=e,s=h(e),[a,l]=(0,r.useState)((()=>function(e){let{defaultValue:n,tabValues:o}=e;if(0===o.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(n){if(!p({value:n,tabValues:o}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${n}" but none of its children has the corresponding value. Available values are: ${o.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return n}const r=o.find((e=>e.default))??o[0];if(!r)throw new Error("Unexpected error: 0 tabValues");return r.value}({defaultValue:n,tabValues:s}))),[c,u]=m({queryString:o,groupId:t}),[f,x]=function(e){let{groupId:n}=e;const o=function(e){return e?`docusaurus.tab.${e}`:null}(n),[t,s]=(0,d.Dv)(o);return[t,(0,r.useCallback)((e=>{o&&s.set(e)}),[o,s])]}({groupId:t}),v=(()=>{const e=c??f;return p({value:e,tabValues:s})?e:null})();(0,i.A)((()=>{v&&l(v)}),[v]);return{selectedValue:a,selectValue:(0,r.useCallback)((e=>{if(!p({value:e,tabValues:s}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),x(e)}),[u,x,s]),tabValues:s}}var x=o(9136);const v={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var j=o(4848);function g(e){let{className:n,block:o,selectedValue:r,selectValue:a,tabValues:i}=e;const l=[],{blockElementScrollPositionUntilNextRender:c}=(0,s.a_)(),d=e=>{const n=e.currentTarget,o=l.indexOf(n),t=i[o].value;t!==r&&(c(n),a(t))},u=e=>{let n=null;switch(e.key){case"Enter":d(e);break;case"ArrowRight":{const o=l.indexOf(e.currentTarget)+1;n=l[o]??l[0];break}case"ArrowLeft":{const o=l.indexOf(e.currentTarget)-1;n=l[o]??l[l.length-1];break}}n?.focus()};return(0,j.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,t.A)("tabs",{"tabs--block":o},n),children:i.map((e=>{let{value:n,label:o,attributes:s}=e;return(0,j.jsx)("li",{role:"tab",tabIndex:r===n?0:-1,"aria-selected":r===n,ref:e=>{l.push(e)},onKeyDown:u,onClick:d,...s,className:(0,t.A)("tabs__item",v.tabItem,s?.className,{"tabs__item--active":r===n}),children:o??n},n)}))})}function b(e){let{lazy:n,children:o,selectedValue:s}=e;const a=(Array.isArray(o)?o:[o]).filter(Boolean);if(n){const e=a.find((e=>e.props.value===s));return e?(0,r.cloneElement)(e,{className:(0,t.A)("margin-top--md",e.props.className)}):null}return(0,j.jsx)("div",{className:"margin-top--md",children:a.map(((e,n)=>(0,r.cloneElement)(e,{key:n,hidden:e.props.value!==s})))})}function y(e){const n=f(e);return(0,j.jsxs)("div",{className:(0,t.A)("tabs-container",v.tabList),children:[(0,j.jsx)(g,{...n,...e}),(0,j.jsx)(b,{...n,...e})]})}function k(e){const n=(0,x.A)();return(0,j.jsx)(y,{...e,children:u(e.children)},String(n))}},7985:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>p,frontMatter:()=>l,metadata:()=>r,toc:()=>u});const r=JSON.parse('{"id":"install-and-deploy/docker","title":"Getting Started with Docker Compose","description":"Guide to deploying Cardano Rosetta Java using Docker Compose","source":"@site/docs/install-and-deploy/docker.md","sourceDirName":"install-and-deploy","slug":"/install-and-deploy/docker","permalink":"/cardano-rosetta-java/docs/install-and-deploy/docker","draft":false,"unlisted":false,"editUrl":"https://github.com/cardano-foundation/cardano-rosetta-java/tree/main/docs/docs/install-and-deploy/docker.md","tags":[],"version":"current","lastUpdatedBy":"Lincon Vidal","lastUpdatedAt":1770206313000,"sidebarPosition":2,"frontMatter":{"sidebar_position":2,"title":"Getting Started with Docker Compose","description":"Guide to deploying Cardano Rosetta Java using Docker Compose"},"sidebar":"tutorialSidebar","previous":{"title":"Boot Sequence","permalink":"/cardano-rosetta-java/docs/install-and-deploy/boot-sequence"},"next":{"title":"Hardware Profiles","permalink":"/cardano-rosetta-java/docs/install-and-deploy/hardware-profiles"}}');var t=o(4848),s=o(8453),a=o(5537),i=o(9329);const l={sidebar_position:2,title:"Getting Started with Docker Compose",description:"Guide to deploying Cardano Rosetta Java using Docker Compose"},c="Deploying with Docker Compose",d={},u=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Deployment",id:"deployment",level:2},{value:"Using Docker Compose",id:"using-docker-compose",level:3},{value:"Syncing the Node First",id:"syncing-the-node-first",level:4},{value:"Index Application",id:"index-application",level:4},{value:"Operation Modes",id:"operation-modes",level:2},{value:"Monitoring and Maintenance",id:"monitoring-and-maintenance",level:2},{value:"Useful Commands",id:"useful-commands",level:3},{value:"Troubleshooting Common Issues",id:"troubleshooting-common-issues",level:3},{value:"Important Container Paths",id:"important-container-paths",level:3},{value:"Running Integration Tests",id:"running-integration-tests",level:2},{value:"Hardware Profiles",id:"hardware-profiles",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"deploying-with-docker-compose",children:"Deploying with Docker Compose"})}),"\n",(0,t.jsx)(n.p,{children:"Starting from version 2.0.0, Docker Compose is the only supported deployment method. This guide provides instructions for deploying Cardano Rosetta Java using Docker Compose."}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsx)(n.p,{children:"Before you begin, ensure you have the following installed:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Docker"}),"\n",(0,t.jsx)(n.li,{children:"Docker Compose"}),"\n",(0,t.jsx)(n.li,{children:"Java 24"}),"\n",(0,t.jsx)(n.li,{children:"For integration tests: Node 14+"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"deployment",children:"Deployment"}),"\n",(0,t.jsx)(n.h3,{id:"using-docker-compose",children:"Using Docker Compose"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Clone the repository"}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/cardano-foundation/cardano-rosetta-java.git\n"})}),"\n",(0,t.jsxs)(n.ol,{start:"2",children:["\n",(0,t.jsxs)(n.li,{children:["Use the provided environment files or modify them if necessary:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The default configuration is in ",(0,t.jsx)(n.code,{children:".env.docker-compose"})]}),"\n",(0,t.jsxs)(n.li,{children:["Choose a hardware profile from the available options (see ",(0,t.jsx)(n.a,{href:"./hardware-profiles",children:"Hardware Profiles"})," for details):"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Entry level hardware profile\ndocker compose --env-file .env.docker-compose \\\n  --env-file .env.docker-compose-profile-entry-level \\\n  -f docker-compose.yaml up -d\n\n# Mid-level hardware profile\ndocker compose --env-file .env.docker-compose \\\n  --env-file .env.docker-compose-profile-mid-level \\\n  -f docker-compose.yaml up -d\n"})}),"\n",(0,t.jsxs)(n.admonition,{title:"Managing Environment Files",type:"tip",children:[(0,t.jsxs)(n.p,{children:["To avoid environment variable warnings when running ",(0,t.jsx)(n.code,{children:"docker compose"})," commands later (like ",(0,t.jsx)(n.code,{children:"docker compose logs"}),"), you can merge the environment files:"]}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# For mainnet with mid-level profile:\ncat .env.docker-compose .env.docker-compose-profile-mid-level > .env\n\n# For preprod with entry-level profile:\ncat .env.docker-compose-preprod .env.docker-compose-profile-entry-level > .env\n\n# Now you can run commands without warnings:\ndocker compose ps\ndocker compose logs -f\n"})})]}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsx)(n.p,{children:"The first time you run the command, it will take significant time to build the cardano-node.\nOn subsequent runs, it will use the cached version."})}),"\n",(0,t.jsx)(n.h4,{id:"syncing-the-node-first",children:"Syncing the Node First"}),"\n",(0,t.jsx)(n.p,{children:"If you want to sync the node first before starting other services:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Start only the cardano-node\ndocker compose --env-file .env.docker-compose -f docker-compose.yaml up cardano-node\n\n# Once the node reaches the tip, start the rest of the services\ndocker compose --env-file .env.docker-compose -f docker-compose.yaml up\n"})}),"\n",(0,t.jsxs)(n.admonition,{title:"Node Synchronization",type:"tip",children:[(0,t.jsxs)(n.p,{children:["To speed up the initial synchronization process, you can use ",(0,t.jsx)(n.a,{href:"https://mithril.network/doc/",children:"Mithril"})," snapshots by setting ",(0,t.jsx)(n.code,{children:"MITHRIL_SYNC=true"})," in your environment file."]}),(0,t.jsx)(n.p,{children:"Mithril provides cryptographically certified blockchain snapshots for multiple Cardano networks (mainnet, preprod, preview) and is integrated directly into the Docker setup. This can reduce synchronization time from days to hours."})]}),"\n",(0,t.jsx)(n.h4,{id:"index-application",children:"Index Application"}),"\n",(0,t.jsxs)(n.p,{children:["After initial blockchain synchronization, the ",(0,t.jsx)(n.code,{children:"index-applier"})," container creates required database indexes. This process:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Runs automatically when sync reaches ",(0,t.jsx)(n.code,{children:"APPLYING_INDEXES"})," stage"]}),"\n",(0,t.jsx)(n.li,{children:"Takes approximately 6 hours on mainnet"}),"\n",(0,t.jsxs)(n.li,{children:["Uses ",(0,t.jsx)(n.code,{children:"CREATE INDEX CONCURRENTLY"})," to avoid blocking the indexer"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Monitor the sync stage via ",(0,t.jsx)(n.code,{children:"/network/status"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'curl -s http://localhost:8082/network/status \\\n  -H "Content-Type: application/json" \\\n  -d \'{"network_identifier":{"blockchain":"cardano","network":"mainnet"}}\' \\\n  | jq \'.sync_status.stage\'\n'})}),"\n",(0,t.jsxs)(n.p,{children:["For details on customizing indexes, see ",(0,t.jsx)(n.a,{href:"../advanced-configuration/index-management",children:"Index Management"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"operation-modes",children:"Operation Modes"}),"\n",(0,t.jsxs)(n.p,{children:["For information about running in online mode (default) or offline mode (for air-gapped environments), see the ",(0,t.jsx)(n.a,{href:"../core-concepts/operation-modes",children:"Operation Modes"})," documentation."]}),"\n",(0,t.jsx)(n.h2,{id:"monitoring-and-maintenance",children:"Monitoring and Maintenance"}),"\n",(0,t.jsx)(n.h3,{id:"useful-commands",children:"Useful Commands"}),"\n","\n",(0,t.jsxs)(a.A,{children:[(0,t.jsx)(i.A,{value:"logs",label:"Viewing Logs",default:!0,children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Follow service logs\ndocker compose logs -f api\ndocker compose logs -f yaci-indexer\ndocker compose logs -f cardano-node\n\n# View all logs\ndocker compose logs -f\n"})})}),(0,t.jsx)(i.A,{value:"management",label:"Service Management",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Check service status\ndocker compose ps\n\n# Stop all services\ndocker compose down\n\n# Restart a specific service\ndocker compose restart api\n\n# Start specific services\ndocker compose up -d cardano-node db\n"})})}),(0,t.jsx)(i.A,{value:"interactive",label:"Interactive Shell",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Get interactive bash shell in cardano-node\ndocker compose exec cardano-node bash\n\n# Check node sync status\ndocker compose exec cardano-node cardano-cli query tip --mainnet\n"})})})]}),"\n",(0,t.jsx)(n.h3,{id:"troubleshooting-common-issues",children:"Troubleshooting Common Issues"}),"\n",(0,t.jsxs)(n.admonition,{title:"Connection Issues",type:"caution",children:[(0,t.jsx)(n.p,{children:"If you experience connection losses between yaci-indexer and the cardano node, you can fix it by running:"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker compose restart yaci-indexer\n"})})]}),"\n",(0,t.jsx)(n.h3,{id:"important-container-paths",children:"Important Container Paths"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Path"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/node/db"})}),(0,t.jsx)(n.td,{children:"Cardano Node Data"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/var/lib/postgresql/data"})}),(0,t.jsx)(n.td,{children:"PostgreSQL Data"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/networks"})}),(0,t.jsx)(n.td,{children:"Network config location"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"/logs"})}),(0,t.jsx)(n.td,{children:"Log files for each service"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"running-integration-tests",children:"Running Integration Tests"}),"\n",(0,t.jsxs)(a.A,{children:[(0,t.jsxs)(i.A,{value:"setup",label:"Setup Environment",default:!0,children:[(0,t.jsx)(n.p,{children:"Start the test environment:"}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker compose --env-file .env.IntegrationTest \\\n  -f docker-integration-test-environment.yaml up --build -d --wait\n"})})]}),(0,t.jsx)(i.A,{value:"cli",label:"Using CLI",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"# Install newman (Node version 14+ needed)\nnpm install -g newman\n\n# Run tests\nnewman run ./postmanTests/rosetta-java.postman_collection.json \\\n  -e ./postmanTests/Rosetta-java-env.postman_environment.json -r cli\n"})})}),(0,t.jsx)(i.A,{value:"postman",label:"Using Postman",children:(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Install ",(0,t.jsx)(n.a,{href:"https://www.postman.com",children:"Postman"})]}),"\n",(0,t.jsxs)(n.li,{children:["Import the collection:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"./postmanTests/rosetta-java.postman_collection.json"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Import the environment:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"./postmanTests/Rosetta-java-env.postman_environment.json"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:"Run the collection"}),"\n"]})})]}),"\n",(0,t.jsx)(n.h2,{id:"hardware-profiles",children:"Hardware Profiles"}),"\n",(0,t.jsx)(n.p,{children:"Cardano Rosetta Java offers different hardware profiles to optimize performance based on your available resources. These profiles configure PostgreSQL and connection pooling parameters."}),"\n",(0,t.jsxs)(n.p,{children:["For detailed information about available profiles and their configurations, see ",(0,t.jsx)(n.a,{href:"./hardware-profiles",children:"Hardware Profiles"}),"."]})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453:(e,n,o)=>{o.d(n,{R:()=>a,x:()=>i});var r=o(6540);const t={},s=r.createContext(t);function a(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(s.Provider,{value:n},e.children)}},9329:(e,n,o)=>{o.d(n,{A:()=>a});o(6540);var r=o(4164);const t={tabItem:"tabItem_Ymn6"};var s=o(4848);function a(e){let{children:n,hidden:o,className:a}=e;return(0,s.jsx)("div",{role:"tabpanel",className:(0,r.A)(t.tabItem,a),hidden:o,children:n})}}}]);