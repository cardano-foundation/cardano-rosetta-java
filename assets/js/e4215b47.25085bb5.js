"use strict";(self.webpackChunkrosetta_docs=self.webpackChunkrosetta_docs||[]).push([[5189],{5447:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>i,contentTitle:()=>c,default:()=>h,frontMatter:()=>a,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"advanced-configuration/unparsed_blocks","title":"Handling Unparsed Blocks","description":"1. Overview","source":"@site/docs/advanced-configuration/unparsed_blocks.md","sourceDirName":"advanced-configuration","slug":"/advanced-configuration/unparsed_blocks","permalink":"/cardano-rosetta-java/docs/advanced-configuration/unparsed_blocks","draft":false,"unlisted":false,"editUrl":"https://github.com/cardano-foundation/cardano-rosetta-java/tree/main/docs/docs/advanced-configuration/unparsed_blocks.md","tags":[],"version":"current","lastUpdatedBy":"Kartiiyer12","lastUpdatedAt":1754655688000,"frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Getting Started with H2","permalink":"/cardano-rosetta-java/docs/advanced-configuration/h2-database"},"next":{"title":"Development","permalink":"/cardano-rosetta-java/docs/category/development"}}');var o=s(4848),t=s(8453);const a={},c="Handling Unparsed Blocks",i={},d=[{value:"1. Overview",id:"1-overview",level:2},{value:"2. How to Use",id:"2-how-to-use",level:2},{value:"2.1 Review blocks that could not be fully parsed",id:"21-review-blocks-that-could-not-be-fully-parsed",level:3},{value:"Request",id:"request",level:4},{value:"Response",id:"response",level:4},{value:"2.2 Mark blocks as \u201cchecked\u201d if they do not affect users or transactions",id:"22-mark-blocks-as-checked-if-they-do-not-affect-users-or-transactions",level:3},{value:"Request",id:"request-1",level:4},{value:"Response",id:"response-1",level:4},{value:"2.3 What to do when unparsed blocks are detected",id:"23-what-to-do-when-unparsed-blocks-are-detected",level:3}];function l(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"handling-unparsed-blocks",children:"Handling Unparsed Blocks"})}),"\n",(0,o.jsx)(n.h2,{id:"1-overview",children:"1. Overview"}),"\n",(0,o.jsxs)(n.p,{children:["In some cases, ",(0,o.jsx)(n.strong,{children:"yaci-core"})," may not be able to parse certain Cardano blocks due to unexpected or malformed data. To address this, ",(0,o.jsx)(n.strong,{children:"yaci-store"})," has introduced a feature that allows these ",(0,o.jsx)(n.strong,{children:"unparsed blocks to be ignored"})," and ",(0,o.jsx)(n.strong,{children:"stored in a separate error table"})," in the database, instead of halting the indexing process."]}),"\n",(0,o.jsx)(n.p,{children:"With this graceful error handling in place, it's now possible to surface these parse-error blocks to exchanges and integrators so they can:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Detect if any of their transactions are present in an errored block."}),"\n",(0,o.jsx)(n.li,{children:"Review and \u201cmark checked\u201d blocks if they do not impact their users or operations."}),"\n"]}),"\n",(0,o.jsxs)(n.p,{children:["This capability is exposed as ",(0,o.jsx)(n.strong,{children:"Cardano network-specific procedure calls"}),", using ",(0,o.jsxs)(n.strong,{children:["Coinbase Mesh\u2019s generic ",(0,o.jsx)(n.code,{children:"/call"})," endpoint"]}),", which supports ",(0,o.jsx)(n.strong,{children:"dynamic method routing"}),". This allows clients to query and update the state of errored blocks in a flexible and standardized way."]}),"\n",(0,o.jsxs)(n.p,{children:["Starting from ",(0,o.jsx)(n.strong,{children:"Rosetta-java version 1.3.0"}),", the parameter ",(0,o.jsx)(n.code,{children:"CONTINUE_PARSING_ON_ERROR=true|false"})," has been introduced:"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["When it is set to ",(0,o.jsx)(n.code,{children:"true"}),", yaci-core will skip unparsed blocks and add them to the error table."]}),"\n",(0,o.jsxs)(n.li,{children:["When it is set to ",(0,o.jsx)(n.code,{children:"false"}),", yaci-core will stop indexing when it encounters an unparsed block."]}),"\n"]}),"\n",(0,o.jsx)(n.hr,{}),"\n",(0,o.jsx)(n.h2,{id:"2-how-to-use",children:"2. How to Use"}),"\n",(0,o.jsxs)(n.p,{children:["You can interact with the parse-error block system through the ",(0,o.jsx)(n.code,{children:"/call"})," endpoint. Below are the available operations."]}),"\n",(0,o.jsx)(n.h3,{id:"21-review-blocks-that-could-not-be-fully-parsed",children:"2.1 Review blocks that could not be fully parsed"}),"\n",(0,o.jsx)(n.p,{children:"Use this call to get the list of blocks that failed to parse."}),"\n",(0,o.jsx)(n.h4,{id:"request",children:"Request"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'curl --location \'http://localhost:8082/call\' \\\n--header \'Content-Type: application/json\' \\\n--data \'{\n  "network_identifier": {\n    "blockchain": "cardano",\n    "network": "preprod"\n  },\n  "method": "get_parse_error_blocks",\n  "parameters": {\n    "status": "UNREVIEWED"\n  }\n}\'\n'})}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Pagination is not required, as the number of errored blocks is expected to be low."}),"\n"]})}),"\n",(0,o.jsx)(n.h4,{id:"response",children:"Response"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n    "result": {\n        "parse_error_blocks": [\n            {\n                "error_id": 1,\n                "block_number": 3686994,\n                "status": "UNREVIEWED",\n                "lastUpdated": "2025-07-18T16:18:00.266457",\n                "note": "Please review all transactions within a block, https://explorer.cardano.org/block/3686994"\n            },\n            {\n                "error_id": 2,\n                "block_number": 3686995,\n                "status": "UNREVIEWED",\n                "lastUpdated": "2025-07-18T16:18:00.266457",\n                "note": "Please review all transactions within a block, https://explorer.cardano.org/block/3686995"\n            } \n        ]\n    },\n    "idempotent": false\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["\ud83d\udcda For detailed information, please see the ",(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.a,{href:"/cardano-rosetta-java/api#tag/call/post/call",children:"API page"})}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"22-mark-blocks-as-checked-if-they-do-not-affect-users-or-transactions",children:"2.2 Mark blocks as \u201cchecked\u201d if they do not affect users or transactions"}),"\n",(0,o.jsx)(n.p,{children:"After reviewing a block, you can mark it as reviewed with a comment and status."}),"\n",(0,o.jsx)(n.h4,{id:"request-1",children:"Request"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:'curl --location \'http://localhost:8082/call\' \\\n--header \'Content-Type: application/json\' \\\n--data \'{\n  "network_identifier": {\n    "blockchain": "cardano",\n    "network": "preprod"\n  },\n  "method": "mark_parse_error_block_checked",\n  "parameters": {\n    "block_number": 3686994,\n    "status": "REVIEWED_DOES_NOT_AFFECT_US",\n    "comment": "no impact to operation",\n    "checked_by": "Admin"\n  }\n}\n'})}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"block_number"})," specifies which block to update."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"status"})," reflects the outcome of your review, e.g., REVIEWED_DOES_NOT_AFFECT_US."]}),"\n",(0,o.jsxs)(n.li,{children:["Use ",(0,o.jsx)(n.code,{children:"comment"})," and ",(0,o.jsx)(n.code,{children:"checked_by"})," fields to provide audit context."]}),"\n"]})}),"\n",(0,o.jsx)(n.h4,{id:"response-1",children:"Response"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n    "result": {\n        "parse_error_blocks_response": [\n            {\n                "error_id": 1,\n                "block_number": 3686994,\n                "status": "REVIEWED_DOES_NOT_AFFECT_US",\n                "comment": "no impact to operation",\n                "checked_by": "Admin",\n                "lastUpdated": "2025-07-28T04:25:57.632987219"\n            }\n        ]\n    },\n    "idempotent": true\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["\ud83d\udcda For detailed information, please see the ",(0,o.jsx)(n.strong,{children:(0,o.jsx)(n.a,{href:"/cardano-rosetta-java/api#tag/call/post/call",children:"API page"})}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"23-what-to-do-when-unparsed-blocks-are-detected",children:"2.3 What to do when unparsed blocks are detected"}),"\n",(0,o.jsxs)(n.p,{children:["When ",(0,o.jsx)(n.strong,{children:"yaci-core"})," encounters unparsed blocks, and you want to attempt parsing them again after resolving the issue (e.g. upgrading parser logic), follow these steps:"]}),"\n",(0,o.jsxs)(n.ol,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsxs)(n.strong,{children:["Upgrade ",(0,o.jsx)(n.code,{children:"yaci-core"})]})," to the latest version that supports parsing the problematic block(s)."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Remove the data volume"})," used by the indexer."]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:" docker compose --env-file .env.docker-compose \\\n --env-file .env.docker-compose-profile-mid-level \\\n -f docker-compose.yaml stop yaci-indexer\n\n docker volume rm cardano-rosetta-java_data\n  \n"})}),"\n",(0,o.jsxs)(n.ol,{start:"3",children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.strong,{children:"Restart the indexer service"})," using Docker Compose:"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:" docker compose --env-file .env.docker-compose \\\n --env-file .env.docker-compose-profile-mid-level \\\n -f docker-compose.yaml start yaci-indexer\n"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(l,{...e})}):l(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>a,x:()=>c});var r=s(6540);const o={},t=r.createContext(o);function a(e){const n=r.useContext(t);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:a(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);