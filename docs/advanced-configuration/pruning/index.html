<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-advanced-configuration/pruning" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Spent UTXO Pruning | Cardano Rosetta Java</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://cardano-foundation.github.io/cardano-rosetta-java/img/cardano-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://cardano-foundation.github.io/cardano-rosetta-java/img/cardano-social-card.jpg"><meta data-rh="true" property="og:url" content="https://cardano-foundation.github.io/cardano-rosetta-java/docs/advanced-configuration/pruning"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Spent UTXO Pruning | Cardano Rosetta Java"><meta data-rh="true" name="description" content="Optimizing disk usage with spent UTXO pruning"><meta data-rh="true" property="og:description" content="Optimizing disk usage with spent UTXO pruning"><link data-rh="true" rel="icon" href="/cardano-rosetta-java/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://cardano-foundation.github.io/cardano-rosetta-java/docs/advanced-configuration/pruning"><link data-rh="true" rel="alternate" href="https://cardano-foundation.github.io/cardano-rosetta-java/docs/advanced-configuration/pruning" hreflang="en"><link data-rh="true" rel="alternate" href="https://cardano-foundation.github.io/cardano-rosetta-java/docs/advanced-configuration/pruning" hreflang="x-default"><link rel="stylesheet" href="/cardano-rosetta-java/assets/css/styles.642e283b.css">
<script src="/cardano-rosetta-java/assets/js/runtime~main.5b129eb8.js" defer="defer"></script>
<script src="/cardano-rosetta-java/assets/js/main.f1881eaa.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script>
<script src="https://cdn.jsdelivr.net/npm/@scalar/api-reference"></script><div id="__docusaurus"><link rel="preload" as="image" href="/cardano-rosetta-java/img/cardano-starburst-blue.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/cardano-rosetta-java/"><div class="navbar__logo"><img src="/cardano-rosetta-java/img/cardano-starburst-blue.svg" alt="Cardano Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/cardano-rosetta-java/img/cardano-starburst-blue.svg" alt="Cardano Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Cardano Rosetta Java</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/cardano-rosetta-java/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/cardano-rosetta-java/api">API Reference</a></div><div class="navbar__items navbar__items--right"><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search (Meta+k)" aria-keyshortcuts="Meta+k"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div><a href="https://github.com/cardano-foundation/cardano-rosetta-java" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cardano-rosetta-java/docs/intro">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/cardano-rosetta-java/docs/category/core-concepts">Core Concepts</a><button aria-label="Expand sidebar category &#x27;Core Concepts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/cardano-rosetta-java/docs/category/install-and-deploy">Install and Deploy</a><button aria-label="Expand sidebar category &#x27;Install and Deploy&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/cardano-rosetta-java/docs/category/user-guides">User Guides</a><button aria-label="Expand sidebar category &#x27;User Guides&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/cardano-rosetta-java/docs/category/advanced-configuration">Advanced Configuration</a><button aria-label="Collapse sidebar category &#x27;Advanced Configuration&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cardano-rosetta-java/docs/advanced-configuration/db-tuning">Database Tuning</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/cardano-rosetta-java/docs/advanced-configuration/pruning">Spent UTXO Pruning</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/cardano-rosetta-java/docs/advanced-configuration/h2-database">Getting Started with H2</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/cardano-rosetta-java/docs/category/development">Development</a><button aria-label="Expand sidebar category &#x27;Development&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/cardano-rosetta-java/docs/contributing">Contributing</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/cardano-rosetta-java/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/cardano-rosetta-java/docs/category/advanced-configuration"><span itemprop="name">Advanced Configuration</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Spent UTXO Pruning</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Spent UTXO Pruning</h1></header>
<p>This guide explains how to optimize disk usage in <strong>cardano-rosetta-java</strong> through spent UTXO pruning, including its impact on Rosetta API endpoints and configuration options.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="understanding-spent-utxo-pruning">Understanding Spent UTXO Pruning<a href="#understanding-spent-utxo-pruning" class="hash-link" aria-label="Direct link to Understanding Spent UTXO Pruning" title="Direct link to Understanding Spent UTXO Pruning">​</a></h2>
<p>Spent UTXO pruning is a disk optimization mechanism in <code>cardano-rosetta-java</code>, powered by its underlying indexer, Yaci-Store. This feature selectively removes data related to spent UTXOs from the local database.</p>
<p><strong>Core Principles:</strong></p>
<ul>
<li><strong>Targeted Deletion</strong>: Only <em>spent</em> UTXOs are removed. All <em>current, unspent</em> UTXOs are preserved, ensuring the accuracy of the present blockchain state and balances.</li>
<li><strong>Distinction from Other Pruning</strong>: This mechanism differs from what is commonly understood as &#x27;pruning&#x27; in some other blockchain contexts, including certain descriptions in the Coinbase Mesh API (formerly Rosetta). Unlike methods such as Bitcoin&#x27;s pruning (which removes entire historical blocks), our approach retains full block history but selectively trims the UTXO set by removing only spent outputs.</li>
</ul>
<p><strong>How it Works:</strong>
When enabled, the pruning process operates as follows:</p>
<ol>
<li>New UTXOs are indexed as transactions occur.</li>
<li>UTXOs are marked as spent when consumed in subsequent transactions.</li>
<li>A background job periodically permanently deletes spent UTXOs that are older than a configurable safety margin (default: 2,160 blocks, ~12 hours on mainnet). This buffer safeguards data integrity against chain rollbacks within Cardano&#x27;s finality window.</li>
</ol>
<p><strong>Impact Summary:</strong></p>
<table><thead><tr><th style="text-align:left">Aspect</th><th style="text-align:left">Effect</th></tr></thead><tbody><tr><td style="text-align:left"><strong>Disk Storage</strong></td><td style="text-align:left">✅ Significantly reduced (e.g., mainnet from ~1TB to ~500GB)</td></tr><tr><td style="text-align:left"><strong>Current UTXO Set</strong></td><td style="text-align:left">✅ Fully preserved; current balances remain accurate</td></tr><tr><td style="text-align:left"><strong>Historical Spent UTXOs</strong></td><td style="text-align:left">⚠️ Permanently deleted beyond the safety margin</td></tr><tr><td style="text-align:left"><strong>Query Performance</strong></td><td style="text-align:left">✅ Improved for queries against the current UTXO set</td></tr></tbody></table>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="impact-on-rosetta-api-endpoints">Impact on Rosetta API Endpoints<a href="#impact-on-rosetta-api-endpoints" class="hash-link" aria-label="Direct link to Impact on Rosetta API Endpoints" title="Direct link to Impact on Rosetta API Endpoints">​</a></h2>
<p>Spent UTXO pruning affects Rosetta API endpoints differently based on their reliance on historical transaction data. The table below summarizes the impact. Note that &quot;Recent&quot; refers to data within the safety margin (default ~12 hours).</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Oldest Block Identifier</div><div class="admonitionContent_BuS1"><p>When pruning is enabled, the <code>/network/status</code> endpoint includes an additional <code>oldest_block_identifier</code> object in its response. This identifier corresponds to the latest fully queryable block with complete data. Below this block index, blocks might have missing data due to pruning, making historical queries unreliable.</p></div></div>
<table><thead><tr><th><strong>Endpoint</strong></th><th><strong>Current State</strong></th><th><strong>Historical Queries</strong></th><th><strong>Impact &amp; Notes</strong></th></tr></thead><tbody><tr><td><code>/account/balance</code></td><td>✅ Works</td><td>⚠️ Limited</td><td><strong>Low</strong> - Current balances unaffected</td></tr><tr><td><code>/account/coins</code></td><td>✅ Works</td><td>⚠️ Limited</td><td><strong>Low</strong> - Current UTXO lists complete</td></tr><tr><td><code>/block</code></td><td>✅ Recent only</td><td>❌ Incomplete</td><td><strong>High</strong> - Missing old transaction inputs</td></tr><tr><td><code>/block/transaction</code></td><td>✅ Recent only</td><td>❌ Incomplete</td><td><strong>High</strong> - Missing spent UTXOs operation details</td></tr><tr><td><code>/search/transactions</code></td><td>⚠️ Recent only</td><td>❌ Limited</td><td><strong>Medium</strong> - Hash search works, address limited</td></tr><tr><td><code>/network/status</code></td><td>✅ Works</td><td>✅ Works</td><td><strong>None</strong> - Returns additional <code>oldest_block_identifier</code> when pruning enabled</td></tr><tr><td><code>/network/*</code></td><td>✅ Works</td><td>✅ Works</td><td><strong>None</strong> - Independent of UTXO data</td></tr><tr><td><code>/construction/*</code></td><td>✅ Works</td><td>✅ Works</td><td><strong>None</strong> - Uses current UTXOs only</td></tr></tbody></table>
<p>After enabling pruning, searching for transactions by their hash will always work, because transaction records themselves are never pruned. However, searching by address is limited: address-based searches rely on the UTXO set, and once spent UTXOs older than the pruning window are deleted, only transactions involving current or recently spent UTXOs can be found by address. Older history is not returned once pruned.</p>
<p>**Enable Spent UTxO removal **: Set <code>REMOVE_SPENT_UTXOS=true</code> in your environment (e.g., in <code>.env.dockerfile</code> or <code>.env.docker-compose</code>).
**Disable Spent UTxO removal ** (default): Set <code>REMOVE_SPENT_UTXOS=false</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="when-spent-utxo-removal-should-be-enabled">When Spent UTxO Removal should be enabled?<a href="#when-spent-utxo-removal-should-be-enabled" class="hash-link" aria-label="Direct link to When Spent UTxO Removal should be enabled?" title="Direct link to When Spent UTxO Removal should be enabled?">​</a></h2>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>Recommended Use Cases</div><div class="admonitionContent_BuS1"><p>Pruning is beneficial in scenarios where optimizing disk space and focusing on current data is prioritized over maintaining a complete historical record. Consider enabling pruning if your use case aligns with the following:</p><ul>
<li><strong>Exchange Integrations &amp; Wallet Services</strong>: Primarily for tracking current balances, processing recent deposits/withdrawals, and validating recent transactions.</li>
<li><strong>Resource-Constrained Environments</strong>: Ideal when disk space is a significant limitation (e.g., under 1TB available for mainnet data).</li>
<li><strong>Tip-of-Chain Operations</strong>: For applications focused on the latest blockchain state rather than deep historical analysis.</li>
<li><strong>Development and Testing</strong>: Useful when a full historical dataset is not essential for development or testing purposes.</li>
</ul></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="when-to-avoid-setting-utxo-removal-feature">When to avoid setting UtxO Removal feature?<a href="#when-to-avoid-setting-utxo-removal-feature" class="hash-link" aria-label="Direct link to When to avoid setting UtxO Removal feature?" title="Direct link to When to avoid setting UtxO Removal feature?">​</a></h2>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Not Suitable For</div><div class="admonitionContent_BuS1"><p>Avoid pruning if your operational or regulatory requirements necessitate access to complete and auditable historical blockchain data. Pruning is generally not suitable if you need:</p><ul>
<li><strong>Complete Historical Data &amp; Deep Queries</strong>: For comprehensive auditing, compliance, data analytics, or block explorer-like functionality that requires querying full transaction history from any point in time.</li>
<li><strong>Strict Compliance and Audit Trails</strong>: If regulatory mandates demand immutable, complete historical records. Pruned data cannot be recovered without a full resync, and historical queries for <code>/block</code> and <code>/block/transaction</code> become unreliable beyond the safety window.</li>
</ul></div></div>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>Data Loss Warning</div><div class="admonitionContent_BuS1"><p>Once data is pruned, it cannot be recovered without a full blockchain resynchronization. Assess your historical data needs carefully before enabling pruning.</p></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuration">Configuration<a href="#configuration" class="hash-link" aria-label="Direct link to Configuration" title="Direct link to Configuration">​</a></h2>
<p>Spent UTXO pruning is configured via environment variables, typically set in your <code>.env.dockerfile</code> or <code>.env.docker-compose</code> file. Below is an example demonstrating the available settings and their default values:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain"># --- Spent UTXO Pruning Configuration ---</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Enable or disable spent UTXO pruning.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Default: false (Pruning is disabled by default)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># To enable, set to: true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">REMOVE_SPENT_UTXOS=true</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Safety margin: Number of recent blocks for which spent UTXOs are retained.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Default: 2160 (approximately 12 hours of blocks on mainnet)</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># This value balances safety for rollbacks against storage savings.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Example: To keep ~24 hours of spent UTXOs, set to 4320.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># Note: Larger REMOVE_SPENT_UTXOS_LAST_BLOCKS_GRACE_COUNT values provide longer historical query support</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"># but use more disk space and delay the realization of storage benefits.</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">REMOVE_SPENT_UTXOS_LAST_BLOCKS_GRACE_COUNT=2160</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>Configuration Guidelines</div><div class="admonitionContent_BuS1"><ul>
<li>Start with the default settings (<code>REMOVE_SPENT_UTXOS=false</code> means pruning is initially off).</li>
<li>If enabling, the provided defaults (<code>REMOVE_SPENT_UTXOS_LAST_BLOCKS_GRACE_COUNT=2160</code>) are sensible starting points.</li>
<li>Adjust <code>REMOVE_SPENT_UTXOS_LAST_BLOCKS_GRACE_COUNT</code> based on your specific needs for recent historical data access. A larger value offers a longer window for historical queries but increases storage.</li>
</ul></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="migration-and-operational-notes">Migration and Operational Notes<a href="#migration-and-operational-notes" class="hash-link" aria-label="Direct link to Migration and Operational Notes" title="Direct link to Migration and Operational Notes">​</a></h2>
<p>This section outlines key considerations when changing pruning settings or managing a system with pruning enabled.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="enabling-pruning-on-an-existing-deployment">Enabling Pruning on an Existing Deployment<a href="#enabling-pruning-on-an-existing-deployment" class="hash-link" aria-label="Direct link to Enabling Pruning on an Existing Deployment" title="Direct link to Enabling Pruning on an Existing Deployment">​</a></h3>
<ol>
<li><strong>Configuration</strong>: Update the necessary environment variables (e.g., <code>REMOVE_SPENT_UTXOS=true</code>) and restart your cardano-rosetta-java services.</li>
<li><strong>Initial Monitoring</strong>: After enabling, closely monitor your application for any errors. Disk usage benefits will typically appear after the first pruning cycle completes.</li>
</ol>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="disabling-pruning">Disabling Pruning<a href="#disabling-pruning" class="hash-link" aria-label="Direct link to Disabling Pruning" title="Direct link to Disabling Pruning">​</a></h3>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Important Considerations</div><div class="admonitionContent_BuS1"><ul>
<li><strong>Halts Deletion, No Restoration</strong>: Setting <code>REMOVE_SPENT_UTXOS=false</code> and restarting services will stop further deletion of spent UTXOs. However, this action <strong>does not restore</strong> any data already pruned.</li>
<li><strong>Full Resync for Complete History</strong>: To regain a complete historical dataset after pruning has been active, a full resynchronization of the blockchain data is required.</li>
<li><strong>Storage Growth Resumes</strong>: Once pruning is disabled, expect storage usage to gradually increase again as new UTXOs (both spent and unspent) accumulate.</li>
</ul></div></div>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="further-reading">Further Reading<a href="#further-reading" class="hash-link" aria-label="Direct link to Further Reading" title="Direct link to Further Reading">​</a></h2>
<ul>
<li><a href="/cardano-rosetta-java/docs/install-and-deploy/env-vars">Environment Variables Reference</a></li>
<li><a href="https://github.com/bloxbean/yaci-store" target="_blank" rel="noopener noreferrer">Yaci-Store Repository</a></li>
<li><a href="https://docs.cdp.coinbase.com/mesh/docs/api-reference/" target="_blank" rel="noopener noreferrer">Coinbase Mesh (formerly Rosetta) API Specification</a></li>
<li><a href="https://docs.cardano.org/learn/eutxo-explainer/" target="_blank" rel="noopener noreferrer">Cardano UTXO Model Documentation</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/cardano-foundation/cardano-rosetta-java/tree/main/docs/docs/advanced-configuration/pruning.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"><span class="theme-last-updated">Last updated<!-- --> on <b><time datetime="2025-06-16T15:40:48.000Z" itemprop="dateModified">Jun 16, 2025</time></b> by <b>Lincon Vidal</b></span></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/cardano-rosetta-java/docs/advanced-configuration/db-tuning"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Database Tuning</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/cardano-rosetta-java/docs/advanced-configuration/h2-database"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Getting Started with H2</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#understanding-spent-utxo-pruning" class="table-of-contents__link toc-highlight">Understanding Spent UTXO Pruning</a></li><li><a href="#impact-on-rosetta-api-endpoints" class="table-of-contents__link toc-highlight">Impact on Rosetta API Endpoints</a></li><li><a href="#when-spent-utxo-removal-should-be-enabled" class="table-of-contents__link toc-highlight">When Spent UTxO Removal should be enabled?</a></li><li><a href="#when-to-avoid-setting-utxo-removal-feature" class="table-of-contents__link toc-highlight">When to avoid setting UtxO Removal feature?</a></li><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a></li><li><a href="#migration-and-operational-notes" class="table-of-contents__link toc-highlight">Migration and Operational Notes</a><ul><li><a href="#enabling-pruning-on-an-existing-deployment" class="table-of-contents__link toc-highlight">Enabling Pruning on an Existing Deployment</a></li><li><a href="#disabling-pruning" class="table-of-contents__link toc-highlight">Disabling Pruning</a></li></ul></li><li><a href="#further-reading" class="table-of-contents__link toc-highlight">Further Reading</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title"></div><ul class="footer__items clean-list"><li class="footer__item">
                  <div class="footer-container">
                    <div class="footer-row">
                      <a href="/cardano-rosetta-java/docs/intro" class="footer-icon-link" aria-label="Documentation">
                        <span class="footer-icon footer-icon-docs"></span>
                      </a>
                      <a href="/cardano-rosetta-java/api" class="footer-icon-link" aria-label="API Reference">
                        <span class="footer-icon footer-icon-api"></span>
                      </a>
                      <a href="https://twitter.com/cardano" class="footer-icon-link" aria-label="Twitter">
                        <span class="footer-icon footer-icon-twitter"></span>
                      </a>
                      <a href="https://github.com/cardano-foundation/cardano-rosetta-java" class="footer-icon-link" aria-label="GitHub">
                        <span class="footer-icon footer-icon-github"></span>
                      </a>
                      <a href="https://cardano.org" class="footer-icon-link" aria-label="Cardano">
                        <span class="footer-icon footer-icon-cardano"></span>
                      </a>
                    </div>
                    <div class="footer-copyright">© 2025 Cardano Stiftung</div>
                  </div>
                </li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"> </div></div></div></footer></div>
</body>
</html>