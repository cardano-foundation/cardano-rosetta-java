version: '3.8'
services:
  yaci-cli:
    image: bloxbean/yaci-cli:0.0.20-beta1
    ports:
      - "${HOST_N2N_PORT}:3001"
      - "${HOST_N2C_SOCAT_PORT}:3333"
      - "${HOST_SUBMIT_API_PORT}:8090"
      - "${HOST_STORE_API_PORT}:8080"
      - "${HOST_CLUSTER_API_PORT}:10000"
      - "${HOST_OGMIOS_PORT}:1337"
      - "${HOST_KUPO_PORT}:1442"
    env_file:
      - .env.IntegrationTest
    entrypoint: ["java", "-jar","/app/yaci-cli.jar", "create-node -o --start" ]
  api:
    extends:
      service: api
      file: docker-yaci.yaml
    volumes:
      - ./test:/test
    healthcheck:
      test: [ "CMD-SHELL", "curl --fail http://localhost:8081/network/options --data @/test/healtCheckMetadata.json -H @/test/healthCheckHeader  -X POST" ]
      interval: 20s
      retries: 20
      start_period: 20s
      timeout: 10s
  yaci-indexer:
    extends:
      service: yaci-indexer
      file: docker-yaci.yaml
  db:
    extends:
      service: db
      file: docker-yaci.yaml