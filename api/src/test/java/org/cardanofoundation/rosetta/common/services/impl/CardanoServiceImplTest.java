package org.cardanofoundation.rosetta.common.services.impl;

import static org.junit.jupiter.api.Assertions.assertEquals;

import java.math.BigInteger;
import java.util.List;
import java.util.Map;
import org.cardanofoundation.rosetta.common.services.CardanoService;
import org.cardanofoundation.rosetta.common.util.Constants;
import org.junit.jupiter.api.Test;

public class CardanoServiceImplTest {

  CardanoService cardanoService = new CardanoServiceImpl(null);
  @Test
  public void calculateFeeTest() {
    List<BigInteger> inputAmounts = List.of(BigInteger.valueOf(5L));
    List<BigInteger> outputAmounts = List.of(BigInteger.valueOf(2L));
    List<BigInteger> withdrawalAmounts = List.of(BigInteger.valueOf(-5L));
    Map<String, Double> depositsSumMap = Map.of(Constants.KEY_REFUNDS_SUM, Double.valueOf(6L),
        Constants.KEY_DEPOSITS_SUM, Double.valueOf(2L), Constants.POOL_DEPOSITS_SUM, Double.valueOf(2L));
    Long l = cardanoService.calculateFee(inputAmounts, outputAmounts, withdrawalAmounts,
        depositsSumMap);

    assertEquals(0L, l);
  }

  @Test
  public void extractTransactionRosettaTxTest() {
    String packedRosettaTransaction = "827901d4383461343030383138323538323037663639306539666234313034383732636136613361353961373636363663633236303737303064323236323839313832643933626564646266393536363138303130313832383235383164363066306233656133363935343261353834383239306237323736343862353833386235646161323535396465626435356466636161316632303161303031653834383038323538316436303564643239333565396262333530383331353062633834326661376661303935623734306335636436363031376532623633313531336532316130353932343937393032316130303032616533643033316130333638313930366131303038313832353832303337363939653262386432333835613031623538393439333638336266326435356635396331646463316637306137303466623936356331613930666633303935383430303935656366376431363731333564653064343831353433306662343037396466383563353865316564633930346363383461323864323361633336393839616631373939653463633662343865383738303131366532383263303365343630353738626337663766353266663663613161616632653138336162643835303166356636a26a6f7065726174696f6e7381a6746f7065726174696f6e5f6964656e746966696572a165696e64657800676163636f756e74a16761646472657373783f616464725f746573743176707761397936376e776534707163347030797939376e6c357a326d7773783965346e717a6c33747676323338637367716b616c6c66616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c7565692d39353634383832326b636f696e5f6368616e6765a26f636f696e5f6964656e746966696572a16a6964656e7469666965727842376636393065396662343130343837326361366133613539613736363636636332363037373030643232363238393138326439336265646462663935363631383a316b636f696e5f616374696f6e6a636f696e5f7370656e746673746174757360647479706565696e707574767472616e73616374696f6e4d6574616461746148657860";
    String rawTx = cardanoService.extractTransactionIfNeeded(packedRosettaTransaction);
    String expectedTx = "84a400818258207f690e9fb4104872ca6a3a59a76666cc2607700d226289182d93beddbf95661801018282581d60f0b3ea369542a5848290b727648b5838b5daa2559debd55dfcaa1f201a001e848082581d605dd2935e9bb35083150bc842fa7fa095b740c5cd66017e2b631513e21a05924979021a0002ae3d031a03681906a1008182582037699e2b8d2385a01b589493683bf2d55f59c1ddc1f70a704fb965c1a90ff3095840095ecf7d167135de0d4815430fb4079df85c58e1edc904cc84a28d23ac36989af1799e4cc6b48e8780116e282c03e460578bc7f7f52ff6ca1aaf2e183abd8501f5f6";
    assertEquals(expectedTx, rawTx);
  }

  @Test
  public void extractTransactionRawTxTest() {
    String rawTx = "84a400818258207f690e9fb4104872ca6a3a59a76666cc2607700d226289182d93beddbf95661801018282581d60f0b3ea369542a5848290b727648b5838b5daa2559debd55dfcaa1f201a001e848082581d605dd2935e9bb35083150bc842fa7fa095b740c5cd66017e2b631513e21a05924979021a0002ae3d031a03681906a1008182582037699e2b8d2385a01b589493683bf2d55f59c1ddc1f70a704fb965c1a90ff3095840095ecf7d167135de0d4815430fb4079df85c58e1edc904cc84a28d23ac36989af1799e4cc6b48e8780116e282c03e460578bc7f7f52ff6ca1aaf2e183abd8501f5f6";
    String extractedTx = cardanoService.extractTransactionIfNeeded(rawTx);
    assertEquals(rawTx, extractedTx);
  }

}
