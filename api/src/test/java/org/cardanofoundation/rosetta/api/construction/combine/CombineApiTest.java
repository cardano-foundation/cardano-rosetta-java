package org.cardanofoundation.rosetta.api.construction.combine;

import java.io.File;
import java.io.IOException;

import org.springframework.beans.factory.annotation.Autowired;
import co.nstant.in.cbor.CborException;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.openapitools.client.model.ConstructionCombineRequest;
import org.openapitools.client.model.ConstructionCombineResponse;

import org.junit.jupiter.api.Test;

import org.cardanofoundation.rosetta.api.IntegrationTest;
import org.cardanofoundation.rosetta.api.construction.service.ConstructionApiService;

import static org.junit.jupiter.api.Assertions.assertEquals;

public class CombineApiTest extends IntegrationTest {
  @Autowired
  private ConstructionApiService constructionApiService;

  private ConstructionCombineRequest getCombineRequest(String fileName) throws IOException {
    File file = new File(this.getClass().getClassLoader().getResource(fileName).getFile());
    ObjectMapper mapper = new ObjectMapper();
    ConstructionCombineRequest request = mapper.readValue(file, ConstructionCombineRequest.class);
    return request;
  }

  @Test
  public void combineWithMetadataTest() throws IOException, CborException {
    ConstructionCombineRequest combineRequest = getCombineRequest(
        "testdata/construction/combine/combine_with_metadata.json");

    ConstructionCombineResponse constructionCombineResponse = constructionApiService.constructionCombineService(
        combineRequest);
    String signedTransaction = "82790378383461353030383138323538323032663233666438636361383335616632316633616333373562616336303166393765616437356632653739313433626466373166653263346265303433653866303130313832383235383164363162623430663161363437626338386331626436623733386462386562363633353764393236343734656135666664366261613736633966623139323731303832353831643631626234306631613634376263383863316264366237333864623865623636333537643932363437346561356666643662616137366339666231393963343030323139396334303033313930336538303735383230383863613836353435383265383339333738373332333062363634366132323130313334643365343165306263393832346365376265346530623238613839366131303038313832353832303162343030643630616166333465616636646362616239626261343630303161323334393738383663663131303636663738343639333364333065356164336635383430366339323530383133356362303630313837613237303661646538313534373832383637623135323665393631356430363734326265356335366630333761623835383934633039386332616230373937313133336330343737626165653932616466333532376164376363383136663133653165346333363130343132303666353832613231396566363461343031353832303030333665663365316630643366353938396532643135356561353462646232613732633463343536636362393539616634633934383638663437336635613030323538323038363837306566633939633435336138373361313634393263653837373338656337396130656264303634333739613632653263396366346531313932313965303335383164653130303035373534616538663933316135373162313733373036336334393034636233346236633434646264633964653637316362623731313034313930346432313965663635613130313538343036633233313263643439303637656366303932306466376530363731393963353562336661656634656330626365316264326366623939373933393732343738633435383736616632626332373161633735396335636534306163653561333938623966646230653335396633633333336665383536363438383034373830653830a26a6f7065726174696f6e7382a6746f7065726174696f6e5f6964656e746966696572a265696e646578006d6e6574776f726b5f696e64657800676163636f756e74a16761646472657373783a616464723176786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e3763706e6b63707866616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c7565662d39303030306b636f696e5f6368616e6765a26f636f696e5f6964656e746966696572a16a6964656e7469666965727842326632336664386363613833356166323166336163333735626163363031663937656164373566326537393134336264663731666532633462653034336538663a316b636f696e5f616374696f6e6a636f696e5f7370656e74667374617475736773756363657373647479706565696e707574a4746f7065726174696f6e5f6964656e746966696572a165696e64657803686d65746164617461a17818766f7465526567697374726174696f6e4d65746164617461a5687374616b654b6579a2696865785f62797465737840383638373065666339396334353361383733613136343932636538373733386563373961306562643036343337396136326532633963663465313139323139656a63757276655f747970656c65647761726473323535313969766f74696e674b6579a2696865785f62797465737840303033366566336531663064336635393839653264313535656135346264623261373263346334353663636239353961663463393438363866343733663561306a63757276655f747970656c6564776172647332353531396b766f74696e674e6f6e63651904d26d72657761726441646472657373783b7374616b653175797171326132326172756e726674336b396568716337796a707874786a6d76676e6461653830787738396d7779676539736b79706f766f74696e675369676e617475726578803663323331326364343930363765636630393230646637653036373139396335356233666165663465633062636531626432636662393937393339373234373863343538373661663262633237316163373539633563653430616365356133393862396664623065333539663363333333666538353636343838303437383065667374617475736773756363657373647479706570766f7465526567697374726174696f6e767472616e73616374696f6e4d657461646174614865787901703832613231396566363461343031353832303030333665663365316630643366353938396532643135356561353462646232613732633463343536636362393539616634633934383638663437336635613030323538323038363837306566633939633435336138373361313634393263653837373338656337396130656264303634333739613632653263396366346531313932313965303335383164653130303035373534616538663933316135373162313733373036336334393034636233346236633434646264633964653637316362623731313034313930346432313965663635613130313538343036633233313263643439303637656366303932306466376530363731393963353562336661656634656330626365316264326366623939373933393732343738633435383736616632626332373161633735396335636534306163653561333938623966646230653335396633633333336665383536363438383034373830653830";
    assertEquals(signedTransaction, constructionCombineResponse.getSignedTransaction());
  }

  @Test
  public void combineWithByronAddressTest() throws IOException, CborException {
    ConstructionCombineRequest combineRequest = getCombineRequest(
        "testdata/construction/combine/combine_with_byron_addresses.json");

    ConstructionCombineResponse constructionCombineResponse = constructionApiService.constructionCombineService(
        combineRequest);
    String signedTransaction = "8279020c3834613430303831383235383230326632336664386363613833356166323166336163333735626163363031663937656164373566326537393134336264663731666532633462653034336538663031303138323832353831643631626234306631613634376263383863316264366237333864623865623636333537643932363437346561356666643662616137366339666231393237313038323538316436316262343066316136343762633838633162643662373338646238656236363335376439323634373465613566666436626161373663396662313939633430303231393963343030333139303365386131303238313834353832303733666561383064343234323736616430393738643466653533313065386263326434383566356636626233626638373631323938396631313261643561376435383430646332613139343862666139343131623337653864323830623034633438613835616635353838626366353039633066636137393866376234363265626361393264363733336461636331663163366331343633363233633038353430316265303765613432326164346631633534333337356537643364323339336161306235383230646437356531353464613431376265636563353563646432343933323734353431333866303832313130323937643565383761623235653135666164313530663431613066356636a26a6f7065726174696f6e7381a6746f7065726174696f6e5f6964656e746966696572a265696e646578006d6e6574776f726b5f696e64657800676163636f756e74a16761646472657373783b416532746450775550455a4336574a66565178544e4e3274577734736b47724e367a5256756b76784a6d544679316e596b5647514275555255334c66616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c7565662d39303030306b636f696e5f6368616e6765a26f636f696e5f6964656e746966696572a16a6964656e7469666965727842326632336664386363613833356166323166336163333735626163363031663937656164373566326537393134336264663731666532633462653034336538663a316b636f696e5f616374696f6e6a636f696e5f7370656e74667374617475736773756363657373647479706565696e707574767472616e73616374696f6e4d6574616461746148657860";
    assertEquals(signedTransaction, constructionCombineResponse.getSignedTransaction());
  }


}
