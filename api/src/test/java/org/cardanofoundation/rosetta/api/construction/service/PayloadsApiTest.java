package org.cardanofoundation.rosetta.api.construction.service;

import java.io.File;
import java.io.IOException;
import java.util.List;
import jakarta.validation.ConstraintViolationException;

import lombok.val;

import org.springframework.beans.factory.annotation.Autowired;
import com.fasterxml.jackson.databind.ObjectMapper;
import org.openapitools.client.api.ConstructionApi;
import org.openapitools.client.model.ConstructionPayloadsRequest;
import org.openapitools.client.model.ConstructionPayloadsResponse;
import org.openapitools.client.model.NetworkIdentifier;
import org.openapitools.client.model.Operation;

import org.junit.jupiter.api.Assertions;
import org.junit.jupiter.api.Test;

import org.cardanofoundation.rosetta.api.IntegrationTest;

import static org.junit.jupiter.api.Assertions.assertEquals;

class PayloadsApiTest extends IntegrationTest {

  @Autowired
  private ConstructionApiService constructionApiService;

  @Autowired
  private ConstructionApi constructionApi;

  private ConstructionPayloadsRequest getPayloadRequest(String fileName) throws IOException {
    File file = new File(this.getClass().getClassLoader().getResource(fileName).getFile());
    ObjectMapper mapper = new ObjectMapper();

    return mapper.readValue(file, ConstructionPayloadsRequest.class);
  }

  @Test
  void payloadsMultipleInputTests() throws Exception {
    String expectedUnsignedTransaction = "8279013c61343030643930313032383238323538323032663233666438636361383335616632316633616333373562616336303166393765616437356632653739313433626466373166653263346265303433653866303138323538323032663233666438636361383335616632316633616333373562616336303166393765616437356632653739313433626466373166653263346265303433653866303130313832383235383164363162623430663161363437626338386331626436623733386462386562363633353764393236343734656135666664366261613736633966623139323731303832353831643631626234306631613634376263383863316264366237333864623865623636333537643932363437346561356666643662616137366339666231393963343030323139633335303033313930336538a16a6f7065726174696f6e7384a6746f7065726174696f6e5f6964656e746966696572a265696e646578006d6e6574776f726b5f696e64657800676163636f756e74a16761646472657373783a616464723176786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e3763706e6b63707866616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c7565662d39303030306b636f696e5f6368616e6765a26f636f696e5f6964656e746966696572a16a6964656e7469666965727842326632336664386363613833356166323166336163333735626163363031663937656164373566326537393134336264663731666532633462653034336538663a316b636f696e5f616374696f6e6a636f696e5f7370656e74667374617475736773756363657373647479706565696e707574a6746f7065726174696f6e5f6964656e746966696572a265696e646578016d6e6574776f726b5f696e64657800676163636f756e74a16761646472657373783a616464723176786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e3763706e6b63707866616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c7565662d31303030306b636f696e5f6368616e6765a26f636f696e5f6964656e746966696572a16a6964656e7469666965727842326632336664386363613833356166323166336163333735626163363031663937656164373566326537393134336264663731666532633462653034336538663a316b636f696e5f616374696f6e6a636f696e5f7370656e74667374617475736773756363657373647479706565696e707574a6746f7065726174696f6e5f6964656e746966696572a165696e646578027272656c617465645f6f7065726174696f6e7382a165696e64657800a165696e64657801676163636f756e74a16761646472657373783a616464723176786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e3763706e6b63707866616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c75656531303030306673746174757367737563636573736474797065666f7574707574a6746f7065726174696f6e5f6964656e746966696572a165696e646578037272656c617465645f6f7065726174696f6e7382a165696e64657800a165696e64657801676163636f756e74a16761646472657373783a616464723176786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e3763706e6b63707866616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c75656534303030306673746174757367737563636573736474797065666f7574707574";

    assertConstructionPayloads("testdata/construction/payloads/multiple_inputs.json",
        expectedUnsignedTransaction);
  }

  @Test
  void byronInputTest() throws Exception {
    String expectedUnsignedTransaction = "8278f461343030643930313032383138323538323032663233666438636361383335616632316633616333373562616336303166393765616437356632653739313433626466373166653263346265303433653866303130313832383235383164363162623430663161363437626338386331626436623733386462386562363633353764393236343734656135666664366261613736633966623139323731303832353831643631626234306631613634376263383863316264366237333864623865623636333537643932363437346561356666643662616137366339666231393963343030323139396334303033313930336538a16a6f7065726174696f6e7383a6746f7065726174696f6e5f6964656e746966696572a265696e646578006d6e6574776f726b5f696e64657800676163636f756e74a16761646472657373783b416532746450775550455a4336574a66565178544e4e3274577734736b47724e367a5256756b76784a6d544679316e596b5647514275555255334c66616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c7565662d39303030306b636f696e5f6368616e6765a26f636f696e5f6964656e746966696572a16a6964656e7469666965727842326632336664386363613833356166323166336163333735626163363031663937656164373566326537393134336264663731666532633462653034336538663a316b636f696e5f616374696f6e6a636f696e5f7370656e74667374617475736773756363657373647479706565696e707574a6746f7065726174696f6e5f6964656e746966696572a165696e646578017272656c617465645f6f7065726174696f6e7381a165696e64657800676163636f756e74a16761646472657373783a616464723176786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e3763706e6b63707866616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c75656531303030306673746174757367737563636573736474797065666f7574707574a6746f7065726174696f6e5f6964656e746966696572a165696e646578027272656c617465645f6f7065726174696f6e7381a165696e64657800676163636f756e74a16761646472657373783a616464723176786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e3763706e6b63707866616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c75656534303030306673746174757367737563636573736474797065666f7574707574";

    assertConstructionPayloads("testdata/construction/payloads/byronInput.json",
        expectedUnsignedTransaction);
  }

  @Test
  void depositTest() throws Exception {
    String expectedUnsignedTransaction = "827901466135303064393031303238313832353832303266323366643863636138333561663231663361633337356261633630316639376561643735663265373931343362646637316665326334626530343365386630313031383238323538316436316262343066316136343762633838633162643662373338646238656236363335376439323634373465613566666436626161373663396662313932373130383235383164363162623430663161363437626338386331626436623733386462386562363633353764393236343734656135666664366261613736633966623139396334303032316130303661306337303033313930336538303464393031303238313832303038323030353831636262343066316136343762633838633162643662373338646238656236363335376439323634373465613566666436626161373663396662a16a6f7065726174696f6e7384a6746f7065726174696f6e5f6964656e746966696572a265696e646578006d6e6574776f726b5f696e64657800676163636f756e74a16761646472657373783a616464723176786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e3763706e6b63707866616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c7565682d393030303030306b636f696e5f6368616e6765a26f636f696e5f6964656e746966696572a16a6964656e7469666965727842326632336664386363613833356166323166336163333735626163363031663937656164373566326537393134336264663731666532633462653034336538663a316b636f696e5f616374696f6e6a636f696e5f7370656e74667374617475736773756363657373647479706565696e707574a6746f7065726174696f6e5f6964656e746966696572a165696e646578017272656c617465645f6f7065726174696f6e7381a165696e64657800676163636f756e74a16761646472657373783a616464723176786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e3763706e6b63707866616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c75656531303030306673746174757367737563636573736474797065666f7574707574a6746f7065726174696f6e5f6964656e746966696572a165696e646578027272656c617465645f6f7065726174696f6e7381a165696e64657800676163636f756e74a16761646472657373783a616464723176786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e3763706e6b63707866616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c75656534303030306673746174757367737563636573736474797065666f7574707574a5746f7065726174696f6e5f6964656e746966696572a165696e64657803676163636f756e74a16761646472657373783b7374616b653175786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e376361656b376135686d65746164617461a2727374616b696e675f63726564656e7469616ca2696865785f62797465737840314234303044363041414633344541463644434241423942424134363030314132333439373838364346313130363646373834363933334433304535414433466a63757276655f747970656c6564776172647332353531396d6465706f736974416d6f756e74a166616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c756567323030303030306673746174757367737563636573736474797065747374616b654b6579526567697374726174696f6e";

    assertConstructionPayloads("testdata/construction/payloads/deposit.json",
        expectedUnsignedTransaction);
  }

  @Test
  void simpeInputOutputTest() throws Exception {
    String expectedUnsignedTransaction = "8278f461343030643930313032383138323538323032663233666438636361383335616632316633616333373562616336303166393765616437356632653739313433626466373166653263346265303433653866303130313832383235383164363162623430663161363437626338386331626436623733386462386562363633353764393236343734656135666664366261613736633966623139323731303832353831643631626234306631613634376263383863316264366237333864623865623636333537643932363437346561356666643662616137366339666231393963343030323139396334303033313930336538a16a6f7065726174696f6e7383a6746f7065726174696f6e5f6964656e746966696572a265696e646578006d6e6574776f726b5f696e64657800676163636f756e74a16761646472657373783a616464723176786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e3763706e6b63707866616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c7565662d39303030306b636f696e5f6368616e6765a26f636f696e5f6964656e746966696572a16a6964656e7469666965727842326632336664386363613833356166323166336163333735626163363031663937656164373566326537393134336264663731666532633462653034336538663a316b636f696e5f616374696f6e6a636f696e5f7370656e74667374617475736773756363657373647479706565696e707574a6746f7065726174696f6e5f6964656e746966696572a165696e646578017272656c617465645f6f7065726174696f6e7381a165696e64657800676163636f756e74a16761646472657373783a616464723176786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e3763706e6b63707866616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c75656531303030306673746174757367737563636573736474797065666f7574707574a6746f7065726174696f6e5f6964656e746966696572a165696e646578027272656c617465645f6f7065726174696f6e7381a165696e64657800676163636f756e74a16761646472657373783a616464723176786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e3763706e6b63707866616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c75656534303030306673746174757367737563636573736474797065666f7574707574";

    assertConstructionPayloads("testdata/construction/payloads/simpleInputOutput.json",
        expectedUnsignedTransaction);
  }

  @Test
  void stakeKeyDeregistrationTest() throws Exception {
    String expectedUnsignedTransaction = "827901466135303064393031303238313832353832303266323366643863636138333561663231663361633337356261633630316639376561643735663265373931343362646637316665326334626530343365386630313031383238323538316436316262343066316136343762633838633162643662373338646238656236363335376439323634373465613566666436626161373663396662313932373130383235383164363162623430663161363437626338386331626436623733386462386562363633353764393236343734656135666664366261613736633966623139396334303032316130303166323063303033313930336538303464393031303238313832303138323030353831636262343066316136343762633838633162643662373338646238656236363335376439323634373465613566666436626161373663396662a16a6f7065726174696f6e7384a6746f7065726174696f6e5f6964656e746966696572a265696e646578006d6e6574776f726b5f696e64657800676163636f756e74a16761646472657373783a616464723176786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e3763706e6b63707866616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c7565662d39303030306b636f696e5f6368616e6765a26f636f696e5f6964656e746966696572a16a6964656e7469666965727842326632336664386363613833356166323166336163333735626163363031663937656164373566326537393134336264663731666532633462653034336538663a316b636f696e5f616374696f6e6a636f696e5f7370656e74667374617475736773756363657373647479706565696e707574a6746f7065726174696f6e5f6964656e746966696572a165696e646578017272656c617465645f6f7065726174696f6e7381a165696e64657800676163636f756e74a16761646472657373783a616464723176786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e3763706e6b63707866616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c75656531303030306673746174757367737563636573736474797065666f7574707574a6746f7065726174696f6e5f6964656e746966696572a165696e646578027272656c617465645f6f7065726174696f6e7381a165696e64657800676163636f756e74a16761646472657373783a616464723176786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e3763706e6b63707866616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c75656534303030306673746174757367737563636573736474797065666f7574707574a5746f7065726174696f6e5f6964656e746966696572a165696e64657803676163636f756e74a16761646472657373783b7374616b653175786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e376361656b376135686d65746164617461a1727374616b696e675f63726564656e7469616ca2696865785f62797465737840314234303044363041414633344541463644434241423942424134363030314132333439373838364346313130363646373834363933334433304535414433466a63757276655f747970656c6564776172647332353531396673746174757367737563636573736474797065767374616b654b65794465726567697374726174696f6e";

    assertConstructionPayloads("testdata/construction/payloads/stakeKey_deregistration.json",
        expectedUnsignedTransaction);
  }

  @Test
  void dRepDelegationTestKeyHash() throws Exception {
    String expectedUnsignedTransaction = "8279018e6135303064393031303238313832353832303266323366643863636138333561663231663361633337356261633630316639376561643735663265373931343362646637316665326334626530343365386630313031383238323538316436316262343066316136343762633838633162643662373338646238656236363335376439323634373465613566666436626161373663396662313932373130383235383164363162623430663161363437626338386331626436623733386462386562363633353764393236343734656135666664366261613736633966623139396334303032316230303030303031346634366134306230303331393033653830346439303130323831383330393832303035383163626234306631613634376263383863316264366237333864623865623636333537643932363437346561356666643662616137366339666238323030353831633734393834666165346361313731356661316638373539663964383731303135616338376634343961383564656136636639393536646131a16a6f7065726174696f6e7384a6746f7065726174696f6e5f6964656e746966696572a265696e646578006d6e6574776f726b5f696e64657800676163636f756e74a16761646472657373783a616464723176786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e3763706e6b63707866616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c75656c2d39303030303030303030306b636f696e5f6368616e6765a26f636f696e5f6964656e746966696572a16a6964656e7469666965727842326632336664386363613833356166323166336163333735626163363031663937656164373566326537393134336264663731666532633462653034336538663a316b636f696e5f616374696f6e6a636f696e5f7370656e74667374617475736773756363657373647479706565696e707574a6746f7065726174696f6e5f6964656e746966696572a165696e646578017272656c617465645f6f7065726174696f6e7381a165696e64657800676163636f756e74a16761646472657373783a616464723176786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e3763706e6b63707866616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c75656531303030306673746174757367737563636573736474797065666f7574707574a6746f7065726174696f6e5f6964656e746966696572a165696e646578027272656c617465645f6f7065726174696f6e7381a165696e64657800676163636f756e74a16761646472657373783a616464723176786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e3763706e6b63707866616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c75656534303030306673746174757367737563636573736474797065666f7574707574a5746f7065726174696f6e5f6964656e746966696572a165696e64657803676163636f756e74a16761646472657373783b7374616b653175786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e376361656b376135686d65746164617461a2727374616b696e675f63726564656e7469616ca2696865785f62797465737840314234303044363041414633344541463644434241423942424134363030314132333439373838364346313130363646373834363933334433304535414433466a63757276655f747970656c6564776172647332353531396464726570a2626964783837343938346661653463613137313566613166383735396639643837313031356163383766343439613835646561366366393935366461316474797065686b65795f6861736866737461747573677375636365737364747970657264526570566f746544656c65676174696f6e";

    assertConstructionPayloads("testdata/construction/payloads/dRep_delegation-keyhash.json",
            expectedUnsignedTransaction);
  }

  @Test
  void dRepDelegationTestAbstain() throws Exception {
    String expectedUnsignedTransaction = "827901526135303064393031303238313832353832303266323366643863636138333561663231663361633337356261633630316639376561643735663265373931343362646637316665326334626530343365386630313031383238323538316436316262343066316136343762633838633162643662373338646238656236363335376439323634373465613566666436626161373663396662313932373130383235383164363162623430663161363437626338386331626436623733386462386562363633353764393236343734656135666664366261613736633966623139396334303032316230303030303031346634366134306230303331393033653830346439303130323831383330393832303035383163626234306631613634376263383863316264366237333864623865623636333537643932363437346561356666643662616137366339666238313032a16a6f7065726174696f6e7384a6746f7065726174696f6e5f6964656e746966696572a265696e646578006d6e6574776f726b5f696e64657800676163636f756e74a16761646472657373783a616464723176786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e3763706e6b63707866616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c75656c2d39303030303030303030306b636f696e5f6368616e6765a26f636f696e5f6964656e746966696572a16a6964656e7469666965727842326632336664386363613833356166323166336163333735626163363031663937656164373566326537393134336264663731666532633462653034336538663a316b636f696e5f616374696f6e6a636f696e5f7370656e74667374617475736773756363657373647479706565696e707574a6746f7065726174696f6e5f6964656e746966696572a165696e646578017272656c617465645f6f7065726174696f6e7381a165696e64657800676163636f756e74a16761646472657373783a616464723176786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e3763706e6b63707866616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c75656531303030306673746174757367737563636573736474797065666f7574707574a6746f7065726174696f6e5f6964656e746966696572a165696e646578027272656c617465645f6f7065726174696f6e7381a165696e64657800676163636f756e74a16761646472657373783a616464723176786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e3763706e6b63707866616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c75656534303030306673746174757367737563636573736474797065666f7574707574a5746f7065726174696f6e5f6964656e746966696572a165696e64657803676163636f756e74a16761646472657373783b7374616b653175786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e376361656b376135686d65746164617461a2727374616b696e675f63726564656e7469616ca2696865785f62797465737840314234303044363041414633344541463644434241423942424134363030314132333439373838364346313130363646373834363933334433304535414433466a63757276655f747970656c6564776172647332353531396464726570a16474797065676162737461696e66737461747573677375636365737364747970657264526570566f746544656c65676174696f6e";

    assertConstructionPayloads("testdata/construction/payloads/dRep_delegation-abstain.json",
            expectedUnsignedTransaction);
  }

  @Test
  void dRepDelegationTestNoConfidence() throws Exception {
    String expectedUnsignedTransaction = "827901526135303064393031303238313832353832303266323366643863636138333561663231663361633337356261633630316639376561643735663265373931343362646637316665326334626530343365386630313031383238323538316436316262343066316136343762633838633162643662373338646238656236363335376439323634373465613566666436626161373663396662313932373130383235383164363162623430663161363437626338386331626436623733386462386562363633353764393236343734656135666664366261613736633966623139396334303032316230303030303031346634366134306230303331393033653830346439303130323831383330393832303035383163626234306631613634376263383863316264366237333864623865623636333537643932363437346561356666643662616137366339666238313033a16a6f7065726174696f6e7384a6746f7065726174696f6e5f6964656e746966696572a265696e646578006d6e6574776f726b5f696e64657800676163636f756e74a16761646472657373783a616464723176786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e3763706e6b63707866616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c75656c2d39303030303030303030306b636f696e5f6368616e6765a26f636f696e5f6964656e746966696572a16a6964656e7469666965727842326632336664386363613833356166323166336163333735626163363031663937656164373566326537393134336264663731666532633462653034336538663a316b636f696e5f616374696f6e6a636f696e5f7370656e74667374617475736773756363657373647479706565696e707574a6746f7065726174696f6e5f6964656e746966696572a165696e646578017272656c617465645f6f7065726174696f6e7381a165696e64657800676163636f756e74a16761646472657373783a616464723176786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e3763706e6b63707866616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c75656531303030306673746174757367737563636573736474797065666f7574707574a6746f7065726174696f6e5f6964656e746966696572a165696e646578027272656c617465645f6f7065726174696f6e7381a165696e64657800676163636f756e74a16761646472657373783a616464723176786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e3763706e6b63707866616d6f756e74a26863757272656e6379a26673796d626f6c6341444168646563696d616c73066576616c75656534303030306673746174757367737563636573736474797065666f7574707574a5746f7065726174696f6e5f6964656e746966696572a165696e64657803676163636f756e74a16761646472657373783b7374616b653175786135707564786737376733736461646465636d773874766336686d796e79776e34396c6c747434666d766e376361656b376135686d65746164617461a2727374616b696e675f63726564656e7469616ca2696865785f62797465737840314234303044363041414633344541463644434241423942424134363030314132333439373838364346313130363646373834363933334433304535414433466a63757276655f747970656c6564776172647332353531396464726570a164747970656d6e6f5f636f6e666964656e636566737461747573677375636365737364747970657264526570566f746544656c65676174696f6e";

    assertConstructionPayloads("testdata/construction/payloads/dRep_delegation-no_confidence.json",
            expectedUnsignedTransaction);
  }

  @Test
  void operationsHaveIdentifierTest() {
    ConstructionPayloadsRequest request = ConstructionPayloadsRequest
        .builder()
        .operations(List.of(Operation.builder()
            .type("operation")
            .build()))
        .networkIdentifier(NetworkIdentifier.builder()
            .blockchain("cardano")
            .network("mainnet")
            .build())
        .build();

    // Check for not null Identifier is on the level above, at the constructionApi
    ConstraintViolationException exception = Assertions.assertThrows(
        ConstraintViolationException.class,
        () -> constructionApi.constructionPayloads(request));

    Assertions.assertEquals("constructionPayloads.arg0.operations[0].operationIdentifier: must not be null",
        exception.getMessage());
  }

  private void assertConstructionPayloads(String requestFile, String expectedUnsignedTransaction)
      throws Exception {
    ConstructionPayloadsRequest request = getPayloadRequest(requestFile);

    ConstructionPayloadsResponse body = constructionApiService.constructionPayloadsService(
        request);

    val s = body.getUnsignedTransaction();
    System.out.println(s);

    assertEquals(expectedUnsignedTransaction, body.getUnsignedTransaction());
  }

}
